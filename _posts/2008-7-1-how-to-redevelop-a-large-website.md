---
layout: post
title:  "ANWB.nl revamped"
date:   2008-7-1 10:00:00 +0100
categories: habari
---
<h3>Introduction</h3>
<p>The past <span title="Not full time mind you">9 months</span> I have had the pleasure and the privilege to work on one of holland's biggest websites, <a href="http://www.anwb.nl/"><abbr title="Algemene Nederlandse Wielrijders Bond">ANWB</abbr>.nl</a>. I had a lot of fun and learned a lot. I also had the pleasure to work with a great team and I thank you <a href="#thanks">guys</a>, you know how you are.</p><p>As this was the biggest jobs I have ever done, I will take the time to share my experience with you.</p>

<!--more-->
<h3>History <em>( or why )</em></h3>
<p>ANWB had been working with a custom built cms and it began to show the wear and tear of being used and added to in too many years so they decided to go for a complete rebuild. What it lacked was a plan during the development phase was a master plan, so all of these nice features worked against each other. The worst thing was that is was slow ( and to me, that it produced really horrible front end code ).</p>
<p>First we researched on what kind of cms they needed. After some time we decided on <a href="http://hippo.nl/">Hippo</a>, a dutch open source cms. This had some implications: as hippo does not come with a front end right out of the box, so we had to build one ourselves. The reason for that is obvious, once you look at it. Hippo manages content and does that really well. They let others serve that content so that they can focus on their job.</p><p>They asked me to do the front end, - css, html and javascript - and to help others in that field by coaching and teaching</p><h3>Techniques <em>( or what and how )</em></h3>
<h4>Cocoon</h4><p>We built the front-end using <a href="http://cocoon.apache.org/">apache cocoon</a>, which turned the xml from hippo into decent (or so I think) xhtml. The XHTML is only about the structure, not about presentation or behavior. This helped us to built some really versatile and robust templates. There are only 7 templates that serve several thousand pages, so versatile they had to be. Quit a few had some <a href="#overhead">overhead</a> in them that made it even more important that they were robust.</p><p>We also used cocoon and the <a href="http://developer.yahoo.com/yui/compressor/">yui compressor</a> to concatenate and minify the js and css files, something that greatly reduced the number of http requests. It also gave us the freedom to write well documented code and seperate the code into a large number of small files. Each of those files is for something different : we got js files for small functions with half the filesize being comments. When we serve it to the customers, they only get one file instead of 50, without any comments in it which would only increase the file size.</p>
<h4>HTML</h4><p>The html was one of the most important bits of the site, as all of the other stuff (css and js) can't work well with it. The XHTML is one of the most important parts of the front end design, as it is the base upon the other two (CSS and js) work upon. It was refined during several revisions as requirements got clearer. It is one of the >aspects of this project that I am proudest of.</p><p>It is valid xhtml 1.0 transitional and as semantically correct as possible. So : no <code>.redborder2px</code> classes in the <a href="#css">css</a> or superfluous div's (thinking of a large dutch <span title="postbank.nl">bank</span>...). Not everything is perfect, but most of these things come from third parties, so they are out of our control. The bad thing is that some of these (banners and iframes) multiply our loading time by an x-factor, but alas, that is the real world for you.</p><p>Everything should work in all major browsers (we did a variation of the yahoo browser support). In fact the development started on firefox and safari on a mac and IE testing started only after 4 months of building.</p><p>Now if we only could educate the editors how to write proper markup, but alas. That is one of the disadvantages of a real world job: you never know how people will use it.</p>
<h4 id="css">CSS</h4><p>The CSS is also as valid as possible, though it is not completely valid, as we used various CSS versions, as well as some IE specific stuff. The IE declarations are all nicely tucked away in its own conditional stylesheet and no more than the absolute minimum of declarations were used. quite a feat for such a large site...</p>
<h4 id="javascript">Javascript</h4><p>The javascript was done with <a href="http://jquery.com/">jQuery</a> but some older applications still used some  <a href="http://prototypejs.org/">prototype</a> that we had to rewrite.</p><p>Prototype extends some of the native javascript functions in the global namespace, so this collided on some occasions. We rewrote some of the prototype code like <code>prototype.extend to prototype.prototypeextend</code> so it would play nice with the rest of the javascript code.</p><p>We made sure that the javascript was as unobtrusive as possible, something that worked out well in pages we had control over but not so good in the older applications... We also used event delegation which helped us to increase the performance.</p>
<h3 id="overhead">Overhead</h3><p>The real challenge lay in incorporating the more than 40 different applications into the new templates, css and javascript. Some of those were written in the middle ages and the average origin of these was about 1873. What they produced in html is not quite what we wanted and we had a lot of fun tweaking stuff until everything was working.</p><p>We also learned a lot from this, stuff like rewriting parts of prototype and jquery for <a href="#javascript">instance</a><em>needs rephrasing, not clear</em>. We also had to check the javascript that wrote parts of the page and correct the invalid html with even more javascript. Some had js to close unclosed div's which provided a challenge...</p><p>As an idealist I wanted to rewrite those so called applications, but as a pragmatist I didn't (at some urging from the project manager). The cost would have outweighted the benefits but hopefully some will be rewritten in a proper fashion soon.</p><h3>Conclusion</h3><p>At the end of the project we can look at some nice results, the total amount of http requests has gone dramatically down. We started with as much as 15 external css files and 10 external js files, which we reduced to one. We also managed to get rid of all of the inline styles and scripts as well as tables for layout. With that we reduced to average filesize of a html page from <em>170kb</em> to <strong>25kb</strong>, something that speeds things up for our customers.</p><p>As we took all of the presentation and behavior out of the structure, the resulting pages are more flexible : so maintenance should benefit from this.<h3 id="thanks">Thanks <em>( or whom )</em></h3></p><p>During this project I had the pleasure to work with some of the best in their fields. I also could use the work of the builders of <a href="http://ejohn.org/">jQuery</a> and the knowledge of <a href="http://twitter.com/natekoechley">yahoo!</a>, without which I would have been lost. The project was lead by some great project and <a href="http://twitter.com/rcosters/">program managers</a>, without whom our work would not have been as stress free.With javascript issues I could turn to the expertise of a <a href="http://twitter.com/mtrimpe/">co-worker</a> and for cross browser stuff I had a <a href="http://oudenniel.nl/cs/index.php">master</a> to help me.</p><p><em>Last but not least thanks to <a href="http://twitter.com/elduderino78">Gilles Ruppert</a> for editing my post.</em></p>

<!-- Technorati Tags Start -->
<p>Technorati Tags:
<a href="http://technorati.com/tag/ajax" rel="tag">ajax</a>, <a href="http://technorati.com/tag/css" rel="tag">css</a>, <a href="http://technorati.com/tag/Firefox" rel="tag">Firefox</a>, <a href="http://technorati.com/tag/html" rel="tag">html</a>, <a href="http://technorati.com/tag/Internet%20Explorer" rel="tag">Internet Explorer</a>, <a href="http://technorati.com/tag/javascript" rel="tag">javascript</a>, <a href="http://technorati.com/tag/jquery" rel="tag">jquery</a>, <a href="http://technorati.com/tag/Opera" rel="tag">Opera</a>, <a href="http://technorati.com/tag/Safari" rel="tag">Safari</a>, <a href="http://technorati.com/tag/w3c" rel="tag">w3c</a>, <a href="http://technorati.com/tag/web" rel="tag">web</a>, <a href="http://technorati.com/tag/hippo" rel="tag">hippo</a>
</p>
<!-- Technorati Tags End -->